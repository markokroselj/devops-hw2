# Automating deployment of web application stack using Docker and Docker compose

For second homework for DevOps class I set up Docker files for two images and [Docker compose file](https://docs.docker.com/compose/), so the whole application stack can be easily deployed on a server using [Docker](https://www.docker.com/). 

## Web application

App is Vehicle inventory manager. It lets you manage information about SpaceX Starship rockets. For each rocket vehicles, you can view name, type, current location and map of location. You can view vehicles of all types, or just Ship or Booster. Vehicle can be deleted by double clicking on its name or selecting it with the tab and pressing delete key. All vehicles can be deleted at once by clicking Remove all vehicles button. You can message application admin using contact form. 

### API
API is reversed proxied to /api/. It has three GET end points that return all vehicles ``/get-vehicles``, locations ``/get-locations`` and types ``/get-types`` in JSON format. To get a specific vehicle by its id, use ``/get/vehicle/id``. To add a new vehicle use POST endpoint ``/add-vehicle``. For deleting it has two DELETE end points. For deleting all ``/delete-all-vehicles`` and a specific one by its id ``/delete-vehicle/id``

## Application stack

Application stack consist of 5 services. Frontend, backend, MariaDB database, Discord contact form and Caddy. Frontend is made using Node.js, Vite and React.js. For styling it is using Tailwind CSS. Backend REST API is made using Node.js and Express. [Discord contact form](https://github.com/markokroselj/discord-contact-form) is made using PHP, HTMX and Tailwind. Caddy is used as reverse proxy for API, contact form and frontend.

All images are chosen or build to be lightweight and efficient as possible. For better security images for database, frontend and Caddy are specified by their exact tag version. Images for Discord contact form, frontend and backend are custom build. Contact form and frontend is using multi-stage build. Backend and frontend for its first step are using Alpine for their base image. To server static files generated by React, frontend image is using very light weight web server [joseluisq/static-web-server](https://hub.docker.com/r/joseluisq/static-web-server/). 

Docker compose secrets are used to manage password for database. For contact form, Discord web hook is saved inside ``.env`` file. 

Docker image for frontend is build using GitHub actions when new tag is created. Action builds images with tags using semantic versioning. Image is then pushed to Docker Hub registry. You can also manually trigger the action in GitHub.

TLS is automatically configured using Caddy.

Named volumes are used for database and Caddy. Bind mount volume is used for ``Caddyfile``.

Backend starts when database service is heathy using heath check. All services always restart, unless they are manually stopped.
# Host configuration

Application stack was deployed on virtual machine server running Ubuntu 24.04.3. It has 4 core 2.8GHz CPU and 16GB of RAM.

On Host machine I installed Git and Docker.
1. Git
    ``sudo apt install git``
2. Docker
    [Install Docker engine on Ubuntu](https://docs.docker.com/engine/install/ubuntu/)


And then configured firewall
    allowed port 22 for SSH
    ``sudo ufw allow 22``

    enabled firewall
    ``sudo ufw enable``

# Usage
Make sure you have Git and Docker installed.    
1. Point domain to the IP of your machine.
2. Clone this repository  ``https://github.com/markokroselj/devops-hw2.git``.
3. cd into it ``cd devops-hw2``.
3. Change domain inside ``caddy/Caddyfile`` from ``localhost`` to your domain.
4. In the root of the repository create ``db_password.txt`` and put some random password for the database inside.
5. In the root also create ``.env`` file and inside put your Discord web hook. This will be used to send messages from contact service to your Discord server.
6. Start the application stack using ``sudo docker compose up -d``
